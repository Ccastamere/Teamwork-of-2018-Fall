# Storage(Ceph)
> Ceph: A Scalable, High-Performance Distributed File System

## Features 
### 核心设计思想：
- Ceph通过用一个伪随机数据分布函数(CRUSH)替代分布表来最大化的分离数据与元数据管理，
- Ceph利用高度自适应分布式元数据集群,显著提高元数据访问的可扩展性,通过它也提高整个系统的可扩展性。
### 系统设计概览
- 三个主要组件：
  - 客户端：暴露near-POSIX的文件系统接口给主机或进程
  - OSD集群：存储所有数据和元数据
  - 元数据服务器集群：管理名空间(文件名和目录),协调安全与一致性

  ![img1](img1.png)
- 三个基本设计：
  - 分离数据和元数据
    - Ceph中完全消除分配列表的设计
    - 文件数据条带化到可计算的命名对象
    - 通过一个**数据分布函数CRUSH**将这些对象分配给存储设备
      - Ceph首先通过简单哈希算法将对象映射到放置组(PGs)，然后通过CRUSH算法将放置组分配到所有OSD。
      - 这个算法是一个伪随机数据分布算法， 能够有效地将每个PG映射到一个用来存储对象副本的有序OSD序列
      - 数据放置不依赖任何的块或对象列表元数据。为了定位每个对象， CRUSH只需要放置组和OSD的cluster map

  ![img3](img3.png)
  - 动态分布式元数据管理

    我们的设计通过使用一个双向的存储策略,和通过动态子树分区最大化的本地化和缓存效率进一步减少元数据相关的磁盘I / O。
    - 文件和目录元数据在Ceph中很小,几乎完全由目录入口(文件名)和inode(80字节)组成。
    - Ceph中不需要文件分布元数据，对象名称使用inode号， 并通过CRUSH算法分布到OSD
    - 采用基于**动态子树划分**的新型元数据集群结构
      - 通过使用计数器统计每个MDS中元数据的访问量。
      - 任何操作使得受影响inode及其上层节点直到根目录的计数都增加, 从而提供每个MDS一个权值，来描述最近的载荷分布。
      - 定期比较MDS权值, 通过迁移以保证元数据工作负载均匀分布。

    ![img2](img2.png)

    - 它能够适应性智能化地分配职责，可在十个甚至上百个MDS上管理文件系统目录结构。
    - 一个动态的层次分明的分区在每个MDS工作负载中被保留位置，可促进有效更新和预取
    - 元数据服务器的负载分布是基于当前的访问状态，使Ceph能在任何工作负载之下有效的利用当前的MDS资源，获得近似线性扩展性能。
  - 可靠的自动分布的对象存储 RADOS
    - Ceph承担着对存储数据的OSD集群进行数据迁移，备份，故障检测，故障修复的责任
    - OSD可给客户端和元数据服务器提供独立的逻辑对象存储EBOFS，使得Ceph能更加有效的利用计算资源处理能力(CPU和内存)，使每个OSD实现可靠、高可用性的线性扩展性能的对象存储
      - EBOFS设计是一个健壮，灵活并且完全集成B-tree服务，它被用于定位磁盘上对象， 管理块分布和收集索引(PG放置组), 通过开始位置与长度对管理块分配，替代了块列表方式， 使得元数据紧凑


    
   
## Pros & Cons
### Pros
- 本质上，Ceph的这些优势均来源于其先进的核心设计思想，有人将其概括为八个字——“无需查表，算算就好”。基于这种设计思想，Ceph充分发挥存储设备自身的计算能力，同时消除了对系统单一中心节点的依赖，从而实现了真正的无中心结构。基于这一设计思想和结构，Ceph一方面实现了高度的可靠性和可扩展性，另一方面保证了客户端访问的相对低延迟和高聚合带宽。
- 在这个核心设计思想的指导下，Ceph 有许多优秀特性，包括统一存储能力、可扩展性、可靠性、性能、自动化的维护等等。
### Cons
1. 代码质量
   - Ceph主要使用C/C++语言编写，同时外围的很多脚本和工具用了Python。相比于更加“现代”的语言，要想写出具备同样可读性、结构良好、调理清晰代码，C++要困难很多。但是，由于存储作为底层系统，对效率的追求是无止境的，因此不太可能舍弃对于内存等底层系统资源的控制，而使用Java/Python这类的语言。
2. 性能
   - 数据双倍写入
   -  IO路经过长
   -  对高性能硬件的支持有待改进。
3. 业务连续性
   - 当集群非常非常大时，Write-All-Read-One对于硬件可靠性的要求几乎是无法满足的。
## Measurement
### 数据性能
1. OSD的吞吐
  - 每个OSD在不同写入块大小和副本数下的吞吐， 工作负载由20个节点上的400个客户端应用组成，性能最后被磁盘读写带宽限制(58MB/s)所限制, 副本数为2或3时， 磁盘I/O会增大到二到三倍，当osd数固定，副本的增加会降低客户端的数据吞吐
  ![img4](img4.png)
  -  使用EBOFS和使用其他常用文件系统（ext3，ReiserFS，XFS）的性能对比。尽管小的读写性能会有影响，EBOFS还是能最大使用现有的磁盘带宽， 大于32KB时， 读显著的胜过其他文件系统

  ![img5](img5.png)

2. 写延迟

   ![img6](img6.png)
   ![img7](img7.png)
3. 数据分布和可扩展性 
   - Ceph的数据性能跟随OSD数量几乎线性变化。

### 元数据性能
1. 元数据更新延迟
2. 元数据读延迟

![img8](img8.png)
   ![img9](img9.png)
3. 元数据扩展 
![img10](img10.png)

## Comment
- Ceph 是一个开源系统，免费，初始成本低，但是并不是一个产品，后期运维成本高。
他的设计理念先进，运用了CRUSH算法和元数据动态子树分区；使用统一存储架构(Block/File/Object)，存储特性丰富。但是这也导致Ceph系统复杂系高，部署、优化难度较大，后期成本高。

-----

# Network
## 一、不同分类标准
#### 1、地理位置
(1)局域网(LAN)：一般限定在较小的区域内，小于10km的范围，通常采用有效的方式连接起来。

(2)城域网(MAN)：规模局限在一座城市的范围内，10~100km的区域。

(3)广域网(WAN)：网络跨越国界、洲界，甚至全球范围。

(4)个人网：个人局域网就是在个人工作地方把属于个人使用的电子设备（如编写电脑等）用无线技术连接起来的网络，因此也常称为无线个人局域网WPAN，其范围大约在10m左右。

#### 2、传输介质
(1)有线网：采用同轴电缆和双绞线来连接的计算机额网络。

(2)光纤网：光纤网也是有线网的一种，但光纤网采用光导纤维作为传输介质。

(3)无线网：用电磁波作为载体来传输数据。

#### 3.拓扑结构
(1)星型网络：各站点通过点到点的链路与中心站相连。

![星型网络](星型网络.jpg)

(2)环型网络：各站点通过通信介质连成一个封闭的环型。

![环型网络](环型网络.jpg)

(3)总线型网络：网络中所有的站点共享一条数据通道。

![总线型网络](总线型网络.jpg)

#### 4、通信分类
1、点对点：数据以点对点的方式在计算机或通信设备中传输。星型网、环型网采用这种传输方式

2、广播式：数据在共用介质中传输。无线网和总线型网络属于这种类型。

#### 5、使用目的
(1)共享资源：使用者可共享网络中的各种资源，如文件、扫描仪、绘图仪、打印机以及各种服务。Internet网是典型的共享资源网。

(2)数据处理网：用于处理数据的网络，例如科学计算网络、企业经营管理用网络。

(3)数据传输网：用来收集、交换、传输数据的网络，例如情报检索网络。

#### 6、服务分类
(1)客户机/服务器网络：服务器是指专门提供服务的高性能计算机或专用设备，客户机是用户计算机。这是客户机向服务器发出请求并获得服务的一种网络形式，多台客户机可以共享服务器提供的各种资源。

(2)对等网：对等网不要求文件服务器，每台客户机都可以与其他每台客户机对话，共享彼此的信息资源和硬件资源，组网的计算机一般类型相同。

#### 7、其他分类

按信息传输模式的特点来分类的atm网：网内数据采用异步传输模式，数据以53字节单元进行传输，提供高达1.2gbps的传输率，有预测网络延时的能力。可以传输语音、视频等实时信息，是最有发展前途的网络类型之一。

-----------

## 二、优缺点

#### 1、有线网
(1)优点：同轴电缆网比较经济，安装较为便利；双绞线网价格便宜，安装方便。

(2)缺点：同轴电网的方式传输率和抗干扰能力一般，传输距离较短；双绞线网的方式易受干扰，传输率较低，传输距离比同轴电缆要短。

#### 2、光纤网
(1)优点：传输距离长，传输率高，可高达千兆bps，抗干扰性强，不会受到电子监听设备的监听，是高安全性网络的理想选择。

(2)缺点：价格较高，而且需要高水平的安装技术。

#### 3、无线网

(1)优点：联网方式灵活方便，是一种很有前途的连网方式。

(2)缺点：联网费用较高

#### 4、星型网络

(1)优点：容易在网络中增加新的站点，数据的安全性和优先级容易控制，易实现网络监控。

(2)缺点：中心节点的故障会引起整个网络瘫痪。

#### 5、环型网络

(1)优点：容易安装和监控

(2)缺点：结构中容量有限，网络建成后，难以增加新的站点。

#### 6、总线型网络

(1)优点：网络安装简单方便，需要铺设的电缆最短，成本低，某个站点的故障一般不会影响整个网络。

(2)缺点：介质的故障会导致网络瘫痪，总线网安全性低，监控比较困难，增加新站点也不如星型网容易。

#### 7、客户机/服务器网络

(1)优点：这是最常用、最重要的一种网络类型。不仅适合于同类计算机联网，也适合于不同类型的计算机联网，如pc机、mac机的混合联网。这种方式网络安全性容易得到保证，计算机的权限、优先级易于控制，监控容易实现，网络管理能够规范化。

(2)缺点：网络性能在很大程度上取决于服务器的性能和客户机的数量。针对这类网络有很多优化性能的服务器称为专用服务器。银行、证券公司都采用这种类型的网络。

#### 8、对等网

(1)优点：这种网络方式灵活方便。

(2)缺点：较难实现集中管理与监控，安全性也低，较适合于部门内部协同工作的小型网络。

-----

## 三、个人观点
根据上文可知，网络根据不同的标准分成了不同的种类，这些标准从不同的方面剖析了当前网络的优缺点。所以，在选择网络时候，我们可以通过将上面的标准结合起来，再统一规划设计我们需要的网络结构和类型，以此来实现性能最优化和费用最小化。


----
# xPU
***
## Features
随着AI概念火爆全球，做AI芯片的公司也层出不穷。为了让市场和观众能记住自家的产品，各家在芯片命名方面都下了点功夫，既要独特，又要和公司产品契合，还要朗朗上口，也要容易让人记住。比较有意思的是，很多家都采用了“xPU”的命名方式。百度XPU芯片架构突出多样性，着重于计算密集型、基于规则的任务，同时确保效率、性能和灵活性的最大化。XPU的目标是在性能和效率之间实现平衡，并处理多样化的计算任务。FPGA加速器本身很擅长处理某些计算任务，但随着许多小内核交织在一起，多样性程度将会上升。

![img1](img11.png)

## Pros&Cons
### Pros
* 基于FPGA，FPGA是高效的，可以专注于特定计算任务。
* 关注计算密集型、基于规则的多样化计算任务，可以通过提高效率和性能，带来类似CPU的灵活性。
* FPGA中XPU的DSP单元提供了并行处理能力，片外DDR4和HBM接口优化了数据传输，而片上SRAM则提供了必要的存储特性。
* 对于没有数据同步的计算任务，XPU的可扩展性与核心数量呈线性关系。

### Cons
* 欠缺的仍是可编程能力，而这也是涉及FPGA时普遍存在的问题。到目前为止，XPU尚未提供编译器。
* 这款处理器在FPGA上实现，通过订制的逻辑电路提供指令。这些小核心类似于CPU，开发者只能使用汇编语言，而所有的执行都由主机来控制。
* 对于数据同步的计算任务，XPU的可扩展性还需进一步优化。

## Key indicators
### Training
* 高计算性能
* 高精度
* 对海量数据处理能力
* 一定的通用性
* 集中在云端
### Inference
* 用户体验
* 逐渐转移到终端

## Comment
AI的许多数据处理涉及矩阵乘法和加法。大量并行工作的GPU提供了一种廉价的方法，但缺点是更高的功率。具有内置DSP模块和本地存储器的FPGA更节能，但它们通常更昂贵。AI芯片该使用什么方法原理去实现，目前仍然众说纷纭，这是新技术的特点，探索阶段百花齐放，这也与深度学习等算法模型的研发并未成熟有关，即AI的基础理论方面仍然存在很大空白。这是指导芯片如何设计的基本前提。因此，目前集中在如何更好的适应已有的数据流式处理模式进行的芯片优化设计。
